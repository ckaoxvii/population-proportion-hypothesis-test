[{"name":"app.R","content":"# app.R\n# One-sample population proportion hypothesis test (Shiny)\n# Option 2: Modern {bslib} cards + helpers (card(), card_body())\n\nlibrary(shiny)\nlibrary(bslib)\nlibrary(ggplot2)\n\nui <- page_fluid(\n  theme = bs_theme(version = 5, bootswatch = \"flatly\"),\n  # Ensure the app fills the viewport vertically\n  tags$head(tags$style(HTML('\n    html, body { height: 100%; }\n    .app-fill { min-height: 100vh; display: flex; flex-direction: column; }\n    .main-fill { flex: 1 1 auto; }\n  '))),\n\n  layout_sidebar(\n    sidebar = sidebar(\n      title = \"Inputs\",\n      numericInput(\"p0\", \"Null proportion (p0)\", value = 0.5, min = 0, max = 1, step = 0.01),\n      numericInput(\"phat\", \"Sample proportion (p̂)\", value = 0.55, min = 0, max = 1, step = 0.001),\n      numericInput(\"n\", \"Sample size (n)\", value = 100, min = 1, step = 1),\n      numericInput(\"alpha\", \"Significance level (α)\", value = 0.05, min = 0.0001, max = 0.5, step = 0.001),\n      selectInput(\"alt\", \"Alternative hypothesis\",\n                  choices = c(\"Two-sided (p ≠ p0)\" = \"two.sided\",\n                              \"Greater (p > p0)\" = \"greater\",\n                              \"Less (p < p0)\" = \"less\"),\n                  selected = \"two.sided\"),\n      helpText(\"Rule of thumb for normal approx: n*p0 ≥ 10 and n*(1-p0) ≥ 10\")\n    ),\n\n    # Main content: three tabbed cards using bslib helpers\n    div(class = \"app-fill main-fill\",\n      navset_card_pill(\n        nav_panel(\n          \"Test summary\",\n          card_body(\n            tableOutput(\"summary\")\n          )\n        ),\n        nav_panel(\n          \"Conclusion\",\n          card_body(\n            h5(textOutput(\"hypotheses\")),\n            h5(textOutput(\"decision\")),\n            p(textOutput(\"conclusion\"))\n          )\n        ),\n        nav_panel(\n          \"Visualize p-value\",\n          card_body(\n            plotOutput(\"pplot\", height = \"420px\"),\n            div(class = \"text-muted\", style = \"font-size: 0.9rem;\",\n                \"Shaded area = p-value under standard normal curve; vertical line = test statistic (z)\")\n          )\n        )\n      )\n    )\n  )\n)\n\nserver <- function(input, output, session) {\n  # Core reactive calculations\n  calc <- reactive({\n    p0 <- input$p0\n    ph <- input$phat\n    n  <- input$n\n    alpha <- input$alpha\n    alt <- input$alt\n\n    se <- sqrt(p0 * (1 - p0) / n)\n    z  <- (ph - p0) / se\n\n    if (alt == \"two.sided\") {\n      pval <- 2 * pnorm(-abs(z))\n      zcrit <- qnorm(1 - alpha/2)\n      reject <- abs(z) > zcrit\n      crit_desc <- paste0(\"±\", round(zcrit, 3))\n    } else if (alt == \"greater\") {\n      pval <- 1 - pnorm(z)\n      zcrit <- qnorm(1 - alpha)\n      reject <- z > zcrit\n      crit_desc <- paste0(round(zcrit, 3))\n    } else { # less\n      pval <- pnorm(z)\n      zcrit <- qnorm(alpha)\n      reject <- z < zcrit\n      crit_desc <- paste0(round(zcrit, 3))\n    }\n\n    list(p0 = p0, ph = ph, n = n, alpha = alpha, alt = alt,\n         se = se, z = z, pval = pval, zcrit = zcrit, reject = reject,\n         crit_desc = crit_desc)\n  })\n\n  fmt <- function(x, d = 4) formatC(x, format = \"f\", digits = d)\n\n  # Hypotheses text\n  output$hypotheses <- renderText({\n    p0 <- calc()$p0\n    alt <- calc()$alt\n    h1 <- paste0(\"H0: p = \", fmt(p0, 3))\n    h2 <- switch(alt,\n      two.sided = paste0(\"H1: p ≠ \", fmt(p0, 3)),\n      greater   = paste0(\"H1: p > \", fmt(p0, 3)),\n      less      = paste0(\"H1: p < \", fmt(p0, 3))\n    )\n    paste(h1, \" | \", h2)\n  })\n\n  # Summary table\n  output$summary <- renderTable({\n    cdat <- calc()\n    data.frame(\n      Quantity = c(\"Null proportion (p0)\", \"Sample proportion (p̂)\", \"n\",\n                   \"Standard error (SE)\", \"Test statistic (z)\", \"p-value\",\n                   \"Significance (α)\", \"Critical value(s)\"),\n      Value = c(fmt(cdat$p0, 4), fmt(cdat$ph, 4), cdat$n,\n                fmt(cdat$se, 6), fmt(cdat$z, 4), fmt(cdat$pval, 6),\n                fmt(cdat$alpha, 4), cdat$crit_desc),\n      check.names = FALSE\n    )\n  }, striped = TRUE, bordered = TRUE, digits = 4)\n\n  # Decision & conclusion\n  output$decision <- renderText({\n    if (calc()$reject) {\n      paste0(\"Decision: Reject H0 at α = \", fmt(calc()$alpha, 4))\n    } else {\n      paste0(\"Decision: Fail to reject H0 at α = \", fmt(calc()$alpha, 4))\n    }\n  })\n\n  output$conclusion <- renderText({\n    cdat <- calc()\n    dir_text <- switch(cdat$alt,\n      two.sided = \"that p ≠ p0\",\n      greater   = \"that p > p0\",\n      less      = \"that p < p0\"\n    )\n    if (cdat$reject) {\n      paste0(\n        \"There is sufficient evidence to conclude \", dir_text,\n        \" (z = \", fmt(cdat$z, 4), \", p = \", fmt(cdat$pval, 6), \").\"\n      )\n    } else {\n      paste0(\n        \"There is not sufficient evidence to conclude \", dir_text,\n        \" (z = \", fmt(cdat$z, 4), \", p = \", fmt(cdat$pval, 6), \").\"\n      )\n    }\n  })\n\n  # P-value plot\n  output$pplot <- renderPlot({\n    cdat <- calc()\n    z <- cdat$z\n    alt <- cdat$alt\n\n    x <- seq(-4, 4, length.out = 2000)\n    dens <- dnorm(x)\n\n    shade <- switch(alt,\n      two.sided = abs(x) >= abs(z),\n      greater   = x >= z,\n      less      = x <= z\n    )\n\n    df <- data.frame(x = x, y = dens, shade = shade)\n\n    ggplot(df, aes(x, y)) +\n      geom_line(linewidth = 0.9) +\n      geom_area(data = subset(df, shade), aes(y = y), alpha = 0.3) +\n      geom_vline(xintercept = z, linetype = \"dashed\", linewidth = 0.9) +\n      annotate(\"text\", x = z, y = dnorm(z) * 0.95, label = paste0(\"z = \", round(z, 3)), vjust = -0.6) +\n      labs(x = \"z (standard normal)\", y = \"Density\",\n           title = \"P-value area under the standard normal curve\") +\n      theme_minimal(base_size = 13)\n  })\n}\n\nshinyApp(ui, server)","type":"text"}]
